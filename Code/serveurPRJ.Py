import paho.mqtt.client as mqtt

MQTT_BROKER = "172.20.10.9"
MQTT_TOPIC = "casier/ouverture"

# Liste des badges autoris√©s
badges_autorises = {
    "A1B2C3D4": "3",   # Badge 1 ouvre le casier 1
    "12345678": "2",   # Badge 2 ouvre le casier 2
    "40F1ED56" : "4", 
    "44F77FA591490" : "1"
}

def on_connect(client, userdata, flags, rc):
    print("‚úÖ Connect√© au broker MQTT !")
    client.subscribe(MQTT_TOPIC)

def on_message(client, userdata, msg):
    badge_recu = msg.payload.decode()
    print(f"üì© Badge re√ßu : {badge_recu}")

    if badge_recu in badges_autorises:
        casier = badges_autorises[badge_recu]
        print(f"‚úÖ Badge autoris√©. Ouverture du casier {casier}")
        client.publish(MQTT_TOPIC, f"CASIER:{casier}")
    elif "CASIER" not in badge_recu:  # S'assure que ce n'est pas une r√©ponse en cha√Æne
        print("‚ùå Acc√®s refus√© !")
        client.publish(MQTT_TOPIC, "REFUS")



client = mqtt.Client()
client.on_connect = on_connect
client.on_message = on_message

client.connect(MQTT_BROKER, 1883, 60)
client.loop_forever()
